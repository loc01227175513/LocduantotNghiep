"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6211],{86211:(e,a,t)=>{t.r(a),t.d(a,{default:()=>l});var r=t(57437),i=t(2265),s=t(38472),o=t(83798),n=t(66648),d=t(87138);let l=()=>{var e;let[a,t]=(0,i.useState)([]),[l,c]=(0,i.useState)(0),h=localStorage.getItem("appliedCoupons");console.log(null===(e=(h?JSON.parse(h):[])[0])||void 0===e?void 0:e.id_magiamgia,"id_magiamgia");let[m,g]=(0,i.useState)({ten:"",gia:"",soluong:"",hinh:"",tenGiangVien:"",trangthai:"",danhgia:[]}),[u,p]=(0,i.useState)({nameOnCard:"",cardNumber:"",expiryDate:"",cvc:""}),[x,w]=(0,i.useState)(""),[N,v]=(0,i.useState)(""),[b,y]=(0,i.useState)(0);(0,i.useEffect)(()=>{let e=localStorage.getItem("data");if(e)try{let a=JSON.parse(e);s.Z.post("http://huuphuoc.id.vn/api/showgiohang",{id_nguoidung:a.id}).then(e=>{t(e.data.data);let a=e.data.data.reduce((e,a)=>e+a.khoahocs.reduce((e,a)=>e+a.giamgia,0),0);c(a);let r=j();y(r)}).catch(()=>{})}catch(e){}let a=()=>{localStorage.removeItem("appliedCoupons")};return window.addEventListener("beforeunload",a),()=>{window.removeEventListener("beforeunload",a),localStorage.removeItem("appliedCoupons")}},[]);let f=e=>{let{name:a,value:t}=e.target;p(e=>({...e,[a]:t}))},j=()=>{let e=localStorage.getItem("appliedCoupons");if(e){let a=JSON.parse(e),t=0;return a.forEach(e=>{t+=e.giamgia}),t}return 0},S=()=>{let[e,a]=u.expiryDate.split("/");s.Z.post("http://huuphuoc.id.vn/api/thenganhang",{tenthe:u.nameOnCard,sothe:u.cardNumber,thang:e,nam:a,mabaomat:u.cvc}).then(e=>{e.data.success?(v("Card details are valid."),w("")):(v(""),w("Card details are invalid. Please check your card details and try again."))}).catch(()=>{v(""),w("There was an error validating the card details. Please try again later.")})},k=async e=>{if(e.preventDefault(),!u.nameOnCard||!u.cardNumber||!u.expiryDate||!u.cvc){w("Vui l\xf2ng nhập đầy đủ th\xf4ng tin thẻ ng\xe2n h\xe0ng.");return}let[t,r]=u.expiryDate.split("/");try{(await s.Z.post("http://huuphuoc.id.vn/api/thenganhang",{tenthe:u.nameOnCard,sothe:u.cardNumber,thang:t,nam:r,mabaomat:u.cvc,total:l})).data.success&&(await s.Z.post("http://huuphuoc.id.vn/api/thanhtoan",{total:l-l*b/100,id_nguoidung:JSON.parse(localStorage.getItem("data")).id,id_khoahoc:a.map(e=>e.khoahocs.map(e=>e.id)),id_giangvien:a.map(e=>e.khoahocs.map(e=>e.id_giangvien)),gia:a.map(e=>e.khoahocs.map(e=>e.gia)),giamgia:a.map(e=>e.khoahocs.map(e=>e.giamgia)),id_giohang:a.map(e=>e.id)})).data.success?(await s.Z.post("http://huuphuoc.id.vn/api/xoagiohang",{total:l.toFixed(2),id_nguoidung:JSON.parse(localStorage.getItem("data")).id,id_khoahoc:a.map(e=>e.khoahocs.map(e=>e.id))}),await (0,o.vH)(),window.location.href="/",v("Thanh to\xe1n th\xe0nh c\xf4ng."),w("")):(v(""),w("Thanh to\xe1n thất bại. Vui l\xf2ng kiểm tra lại th\xf4ng tin thẻ."))}catch(e){v(""),w("Đ\xe3 xảy ra lỗi trong qu\xe1 tr\xecnh thanh to\xe1n. Vui l\xf2ng thử lại sau.")}};return(0,r.jsx)("div",{className:"container",children:(0,r.jsx)("div",{className:" bg-gray-100 mt-60 mb-60  py-10",children:(0,r.jsxs)("div",{className:"w-full mx-auto px-4",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold mb-6 text-gray-800 text-center",children:"Thanh To\xe1n"}),0===a.length?(0,r.jsx)("p",{className:"text-center text-gray-600",children:"Giỏ h\xe0ng của bạn đang trống."}):(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row -mx-4",children:[(0,r.jsx)("div",{className:"w-full lg:w-2/3 px-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-gray-800",children:"C\xe1c kh\xf3a học trong giỏ h\xe0ng"}),(0,r.jsx)("div",{className:"space-y-4",children:a.map(e=>e.khoahocs.map(e=>(0,r.jsxs)("div",{className:"flex items-center border-b pb-4",children:[(0,r.jsx)(n.default,{width:500,height:300,src:e.hinh,alt:e.ten,className:"w-24 h-24 object-cover rounded-md mr-4"}),(0,r.jsxs)("div",{className:"flex-grow",children:[(0,r.jsx)("h3",{className:"text-xl font-medium text-gray-800",children:e.ten}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Giảng vi\xean: ",e.tenGiangVien]}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Gi\xe1: ",(0,r.jsxs)("span",{className:"text-red-500 font-semibold",children:["$",e.gia]})]}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Giảm Gi\xe1: ",(0,r.jsxs)("span",{className:"text-red-500 font-semibold",children:[b,"%"]})]})]})]},e.id)))})]})}),(0,r.jsxs)("div",{className:"w-full lg:w-1/3 px-4",children:[(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6 mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-gray-800",children:"Th\xf4ng Tin Thanh To\xe1n"}),x&&(0,r.jsx)("div",{className:"mb-4 text-red-600",children:x}),N&&(0,r.jsx)("div",{className:"mb-4 text-green-600",children:N}),(0,r.jsxs)("form",{onSubmit:k,children:[(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700",children:"Name on card"}),(0,r.jsx)("input",{type:"text",name:"nameOnCard",value:u.nameOnCard,onChange:f,onBlur:S,className:"w-full p-2 border border-gray-300 rounded mt-1",required:!0})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("label",{className:"block text-gray-700",children:"Card number"}),(0,r.jsx)("input",{type:"text",name:"cardNumber",value:u.cardNumber,onChange:f,onBlur:S,className:"w-full p-2 border border-gray-300 rounded mt-1",required:!0})]}),(0,r.jsxs)("div",{className:"flex mb-4",children:[(0,r.jsxs)("div",{className:"w-1/2 pr-2",children:[(0,r.jsx)("label",{className:"block text-gray-700",children:"Expiry date"}),(0,r.jsx)("input",{type:"text",name:"expiryDate",value:u.expiryDate,onChange:f,onBlur:S,className:"w-full p-2 border border-gray-300 rounded mt-1",placeholder:"MM/YY",required:!0})]}),(0,r.jsxs)("div",{className:"w-1/2 pl-2",children:[(0,r.jsx)("label",{className:"block text-gray-700",children:"CVC/CVV"}),(0,r.jsx)("input",{type:"text",name:"cvc",value:u.cvc,onChange:f,onBlur:S,className:"w-full p-2 border border-gray-300 rounded mt-1",required:!0})]})]}),(0,r.jsxs)("button",{type:"submit",className:"w-full bg-purple-600 text-white py-3 mt-4 rounded-md hover:bg-purple-700 transition duration-200",children:["Thanh To\xe1n $",(l-l*b/100).toFixed(2)]})]})]}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-md p-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-semibold mb-4 text-gray-800",children:"T\xf3m Tắt Đơn H\xe0ng"}),(0,r.jsxs)("div",{className:"border-b pb-4",children:[(0,r.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Tổng cộng:"}),(0,r.jsxs)("span",{className:"text-gray-800 font-semibold",children:["$",l.toFixed(2)]})]}),(0,r.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Giảm gi\xe1:"}),(0,r.jsxs)("span",{className:"text-gray-800 font-semibold",children:[b,"%"]})]}),(0,r.jsxs)("div",{className:"flex justify-between",children:[(0,r.jsx)("span",{className:"text-gray-600",children:"Th\xe0nh tiền:"}),(0,r.jsxs)("span",{className:"text-gray-800 font-semibold",children:["$",(l-l*b/100).toFixed(2)]})]})]}),(0,r.jsx)("div",{className:"mt-4 text-center",children:(0,r.jsx)(d.default,{href:"/",className:"text-purple-600 hover:underline",children:"Tiếp tục mua sắm "})})]})]})]})]})})})}},83798:(e,a,t)=>{t.d(a,{bx:()=>n,lk:()=>r,on:()=>s,ro:()=>i,vH:()=>d,vg:()=>o});let r=async e=>{let a=new URLSearchParams(window.location.search).get("id");try{let t=await fetch("http://huuphuoc.id.vn/api/addMaGiamGiaKhoaHoc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_khoahoc:a,id_magiamgia:e})});if(!t.ok)throw Error("Failed to add MaGiamGia");return t.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},i=async()=>{try{let e=await fetch("http://huuphuoc.id.vn/api/showAllMaGiamGiaKhoaHoc");if(!e.ok)throw Error("Failed to fetch MaGiamGia data");return e.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},s=async()=>{try{let e=await fetch("http://huuphuoc.id.vn/api/showAllMaGiamGia");if(!e.ok)throw Error("Failed to fetch MaGiamGia data");return e.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},o=async e=>{let a=localStorage.getItem("data");if(!a)throw Error("User not authenticated");let t=JSON.parse(a);try{let a=await fetch("http://huuphuoc.id.vn/api/addNguoiDungMaGiamGia",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trangthai:"Chưa sử dụng",dasudunghientai:"0",id_nguoidung:t.id,id_magiamgia:e.id_magiamgia})});if(!a.ok){let e=await a.json();throw Error(e.message||"Failed to add MaGiamGia")}return a.json()}catch(e){throw console.error("Fetch error:",e),Error(e.message||"Network error or server is down")}},n=async()=>{let e=JSON.parse(localStorage.getItem("data"));if(!e||!e.id)throw Error("User data is missing or invalid");try{let a=await fetch("http://huuphuoc.id.vn/api/showAllNguoiDungMaGiamGia",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_nguoidung:e.id})});if(!a.ok)throw Error("Server error: ".concat(a.statusText));return a.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},d=async()=>{let e=localStorage.getItem("data"),a=localStorage.getItem("appliedCoupons");if(!e)throw Error("User not authenticated");if(!a)throw Error("No applied coupons found");try{var t;let r=JSON.parse(e),i=a?JSON.parse(a):[];if(!r.id||!(null===(t=i[0])||void 0===t?void 0:t.id_magiamgia))throw Error("Invalid user or coupon data");let s=await fetch("http://huuphuoc.id.vn/api/TinhMaGiamGia",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_nguoidung:r.id,id_magiamgia:i[0].id_magiamgia})});if(!s.ok){let e=await s.json();throw Error(e.message||"Failed to add MaGiamGia")}return s.json()}catch(e){throw console.error("Fetch error:",e),Error(e.message||"Network error or server is down")}}}}]);