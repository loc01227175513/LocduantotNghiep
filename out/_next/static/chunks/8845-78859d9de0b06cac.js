"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8845],{58845:(e,r,a)=>{a.d(r,{default:()=>v});var t=a(57437),i=a(2265),o=a(26566),n=a(21167),s=a(44299),l=a(93871),c=a(49566),d=a(87585),h=a(57632),g=a(45582),u=a(15024),m=a(99957),p=a(35903),x=a(42988),w=a(83798),y=a(95956);let f=(0,x.E)(o.x),j=(0,n.B1)({colors:{primary:"rgb(50, 173, 230)"}}),b=()=>{localStorage.getItem("data")||localStorage.setItem("data",JSON.stringify({giangvien:{id:1,name:"Default Giangvien"}})),localStorage.getItem("dataForm")||localStorage.setItem("dataForm",JSON.stringify({id_magiamgia:null}))},v=()=>{let[e,r]=(0,i.useState)([]),[a,n]=(0,i.useState)(null),[x,v]=(0,i.useState)(""),[S,N]=(0,i.useState)(""),[k,G]=(0,i.useState)(""),[E,F]=(0,i.useState)(!1);(0,i.useEffect)(()=>{b(),(async()=>{try{let e=await (0,w.on)();r(e)}catch(e){y.Am.error("Failed to fetch data.")}})()},[]);let C=e=>{n(r=>r===e?null:e)},O=async()=>{if(a)try{let e=JSON.parse(localStorage.getItem("dataForm"))||{};e.id_magiamgia=a,localStorage.setItem("dataForm",JSON.stringify(e)),await (0,w.lk)(a),y.Am.success("Coupon ID sent successfully!")}catch(e){y.Am.error("Error sending coupon ID.")}else y.Am.info("No coupon selected.")},_=e.filter(e=>{let r=!E||e.giamgia>=50;return(""===x||e.giamgia>=x)&&(""===S||e.luotsudung>=S)&&(""===k||new Date(e.ngaybatdau)<=new Date(k)&&new Date(e.ngayketthuc)>=new Date(k))&&r});return(0,t.jsxs)(s.x,{theme:j,children:[(0,t.jsxs)(l.W,{maxW:"full",height:"100vh",py:8,bg:"gray.50",position:"relative",overflowY:"auto",children:[(0,t.jsx)(c.X,{as:"h2",size:"lg",mb:6,color:"primary",textAlign:"center",children:"Danh s\xe1ch M\xe3 Giảm Gi\xe1 Kh\xf3a Học"}),(0,t.jsxs)(o.x,{mb:6,px:4,children:[(0,t.jsxs)(d.P,{placeholder:"Filter by discount percentage",value:x,onChange:e=>v(e.target.value),mb:4,children:[(0,t.jsx)("option",{value:"",children:"All"}),(0,t.jsx)("option",{value:"10",children:"10% or more"}),(0,t.jsx)("option",{value:"20",children:"20% or more"}),(0,t.jsx)("option",{value:"30",children:"30% or more"})]}),(0,t.jsxs)(d.P,{placeholder:"Filter by user count",value:S,onChange:e=>N(e.target.value),mb:4,children:[(0,t.jsx)("option",{value:"",children:"All"}),(0,t.jsx)("option",{value:"100",children:"100 or more"}),(0,t.jsx)("option",{value:"200",children:"200 or more"}),(0,t.jsx)("option",{value:"300",children:"300 or more"})]}),(0,t.jsx)(h.I,{type:"date",placeholder:"Filter by date",value:k,onChange:e=>G(e.target.value),mb:4}),(0,t.jsx)(g.X,{isChecked:E,onChange:e=>F(e.target.checked),mb:4,children:"Chỉ hiển thị khuyến m\xe3i tốt nhất (>= 50%)"})]}),(0,t.jsx)(u.M,{columns:{base:1,sm:2,md:3,lg:4},spacing:6,px:4,children:_.map(e=>(0,t.jsxs)(f,{bg:"white",shadow:"lg",rounded:"xl",p:4,position:"relative",onClick:()=>C(e.id),cursor:"pointer",whileHover:{scale:1.1},transition:{duration:.3},border:"2px solid gray",children:[a===e.id&&(0,t.jsx)(o.x,{as:"i",className:"bi bi-check-circle-fill",position:"absolute",top:4,right:2,color:"green.500",fontSize:"32px"}),(0,t.jsxs)(o.x,{mt:4,color:"gray.800",children:[(0,t.jsxs)(m.x,{fontWeight:"bold",fontSize:"md",children:[(0,t.jsx)("i",{className:"bi ".concat(a===e.id?"bi-tag-fill":"bi-tag"),style:{marginRight:"8px"}}),"M\xe3 số: ",e.maso]}),(0,t.jsxs)(m.x,{fontSize:"md",children:[(0,t.jsx)("i",{className:"bi bi-percent",style:{marginRight:"8px"}}),"Giảm gi\xe1: ",e.giamgia,"%"]}),(0,t.jsxs)(m.x,{fontSize:"md",children:[(0,t.jsx)("i",{className:"bi bi-people",style:{marginRight:"8px"}}),"Lượt sử dụng: ",e.luotsudung]}),(0,t.jsxs)(m.x,{fontSize:"md",children:[(0,t.jsx)("i",{className:"bi bi-person-check",style:{marginRight:"8px"}}),"Sử dụng hiện tại: ",e.sudunghientai]}),(0,t.jsxs)(m.x,{fontSize:"md",children:[(0,t.jsx)("i",{className:"bi bi-calendar-event",style:{marginRight:"8px"}}),"Ng\xe0y bắt đầu: ",e.ngaybatdau]}),(0,t.jsxs)(m.x,{fontSize:"md",children:[(0,t.jsx)("i",{className:"bi bi-calendar-x",style:{marginRight:"8px"}}),"Ng\xe0y kết th\xfac: ",e.ngayketthuc]})]})]},e.id))}),(0,t.jsx)(o.x,{textAlign:"center",mt:6,children:(0,t.jsx)(p.z,{colorScheme:"blue",onClick:O,children:"Public"})})]}),(0,t.jsx)(y.Ix,{})]})}},83798:(e,r,a)=>{a.d(r,{bx:()=>s,lk:()=>t,on:()=>o,ro:()=>i,vH:()=>l,vg:()=>n});let t=async e=>{let r=new URLSearchParams(window.location.search).get("id");try{let a=await fetch("http://huuphuoc.id.vn/api/addMaGiamGiaKhoaHoc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_khoahoc:r,id_magiamgia:e})});if(!a.ok)throw Error("Failed to add MaGiamGia");return a.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},i=async()=>{try{let e=await fetch("http://huuphuoc.id.vn/api/showAllMaGiamGiaKhoaHoc");if(!e.ok)throw Error("Failed to fetch MaGiamGia data");return e.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},o=async()=>{try{let e=await fetch("http://huuphuoc.id.vn/api/showAllMaGiamGia");if(!e.ok)throw Error("Failed to fetch MaGiamGia data");return e.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},n=async e=>{let r=localStorage.getItem("data");if(!r)throw Error("User not authenticated");let a=JSON.parse(r);try{let r=await fetch("http://huuphuoc.id.vn/api/addNguoiDungMaGiamGia",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trangthai:"Chưa sử dụng",dasudunghientai:"0",id_nguoidung:a.id,id_magiamgia:e.id_magiamgia})});if(!r.ok){let e=await r.json();throw Error(e.message||"Failed to add MaGiamGia")}return r.json()}catch(e){throw console.error("Fetch error:",e),Error(e.message||"Network error or server is down")}},s=async()=>{let e=JSON.parse(localStorage.getItem("data"));if(!e||!e.id)throw Error("User data is missing or invalid");try{let r=await fetch("http://huuphuoc.id.vn/api/showAllNguoiDungMaGiamGia",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_nguoidung:e.id})});if(!r.ok)throw Error("Server error: ".concat(r.statusText));return r.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},l=async()=>{let e=localStorage.getItem("data"),r=localStorage.getItem("appliedCoupons");if(!e)throw Error("User not authenticated");if(!r)throw Error("No applied coupons found");try{var a;let t=JSON.parse(e),i=r?JSON.parse(r):[];if(!t.id||!(null===(a=i[0])||void 0===a?void 0:a.id_magiamgia))throw Error("Invalid user or coupon data");let o=await fetch("http://huuphuoc.id.vn/api/TinhMaGiamGia",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_nguoidung:t.id,id_magiamgia:i[0].id_magiamgia})});if(!o.ok){let e=await o.json();throw Error(e.message||"Failed to add MaGiamGia")}return o.json()}catch(e){throw console.error("Fetch error:",e),Error(e.message||"Network error or server is down")}}}}]);