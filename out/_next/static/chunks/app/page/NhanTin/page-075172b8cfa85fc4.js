(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7209],{89306:(e,t,n)=>{Promise.resolve().then(n.t.bind(n,38173,23)),Promise.resolve().then(n.bind(n,45497)),Promise.resolve().then(n.bind(n,1863))},1863:(e,t,n)=>{"use strict";n.d(t,{default:()=>l});var i=n(57437),r=n(2265),a=n(95956);n(53982);var s=n(57587);let o=e=>{let{onClose:t,csrfToken:n,giangVien:s,nguoiDung:o,refreshData:l}=e,[d,c]=(0,r.useState)("nguoidung"),[h,u]=(0,r.useState)({noidung:"",id_giangvien:""}),[g,p]=(0,r.useState)({noidung:"",id_nguoidung:""}),m=e=>{let{name:t,value:n}=e.target;u(e=>({...e,[t]:n}))},x=()=>!!h.noidung&&!!h.id_giangvien||(a.Am.error("Vui l\xf2ng điền đầy đủ th\xf4ng tin."),!1),f=async e=>{if(e.preventDefault(),!x())return;let i=parseInt(h.id_giangvien,10),r=null==o?void 0:o.id,s={noidung:[{sender_id:r,receiver_id:i,content:h.noidung,timestamp:new Date().toISOString(),sender_type:"nguoidung"}],id_nguoidung:r,id_giangvien:i};try{(await fetch("http://huuphuoc.id.vn/api/addNhanTin",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":n},body:JSON.stringify(s)})).ok?(a.Am.success("Th\xeam tin nhắn th\xe0nh c\xf4ng từ Người d\xf9ng!"),t(),l()):a.Am.error("Th\xeam tin nhắn thất bại!")}catch(e){console.error("Lỗi khi th\xeam dữ liệu:",e),a.Am.error("Th\xeam tin nhắn thất bại!")}};return(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50",children:(0,i.jsx)("div",{className:"relative p-4 w-full max-w-2xl max-h-full overflow-y-auto",children:(0,i.jsxs)("div",{className:"relative bg-gray-900 rounded-lg shadow",children:[(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsx)("h2",{className:"text-white text-xl mb-4",children:"Th\xeam Tin Nhắn"}),(0,i.jsx)("div",{className:"flex space-x-4 mb-4",children:(0,i.jsx)("button",{className:"px-4 py-2 rounded-lg ".concat("nguoidung"===d?"bg-blue-700":"bg-blue-500"," text-white"),onClick:()=>c("nguoidung"),children:"Người d\xf9ng"})})]}),"nguoidung"===d&&(0,i.jsxs)("form",{onSubmit:f,children:[(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsx)("label",{className:"block text-white",children:"Giảng vi\xean:"}),(0,i.jsxs)("select",{name:"id_giangvien",value:h.id_giangvien,onChange:m,className:"mt-1 block w-full border border-gray-300 rounded-md p-2 text-white bg-gray-700",required:!0,children:[(0,i.jsx)("option",{value:"",children:"Chọn giảng vi\xean"}),s.map(e=>(0,i.jsx)("option",{value:e.id,children:e.ten},e.id))]})]}),(0,i.jsxs)("div",{className:"p-4",children:[(0,i.jsx)("label",{className:"block text-white",children:"Nội dung:"}),(0,i.jsx)("textarea",{name:"noidung",value:h.noidung,onChange:m,className:"mt-1 block w-full border border-gray-300 rounded-md p-2 text-white bg-gray-700",required:!0})]}),(0,i.jsxs)("div",{className:"p-4 flex justify-end space-x-2",children:[(0,i.jsx)("button",{type:"button",onClick:t,className:"bg-gray-700 text-white px-4 py-2 rounded-lg",children:"Hủy"}),(0,i.jsx)("button",{type:"submit",className:"bg-green-700 text-white px-4 py-2 rounded-lg",children:"Th\xeam từ Người d\xf9ng"})]})]})]})})})},l=()=>{let[e,t]=(0,r.useState)(""),[n,l]=(0,r.useState)([]),[d,c]=(0,r.useState)(null),[h,u]=(0,r.useState)([]),[g,p]=(0,r.useState)(!1),m=()=>{(0,s.tp)().then(e=>{u(e)}).catch(e=>{console.error("Error:",e),a.Am.error("Lỗi khi lấy dữ liệu!")})};return(0,r.useEffect)(()=>{var e;let n=null===(e=document.querySelector('meta[name="csrf-token"]'))||void 0===e?void 0:e.getAttribute("content");n&&t(n)},[]),(0,r.useEffect)(()=>{m()},[]),(0,r.useEffect)(()=>{(0,s.PG)().then(e=>{l(e)}).catch(e=>{console.error("Error:",e),a.Am.error("Lỗi khi lấy dữ liệu!")})},[]),(0,r.useEffect)(()=>{(0,s.H_)().then(e=>{c(e.data)}).catch(e=>{console.error("Error:",e),a.Am.error("Lỗi khi lấy dữ liệu!")})},[]),(0,i.jsxs)(i.Fragment,{children:[" ",(0,i.jsxs)("div",{className:"container",children:[(0,i.jsxs)("section",{className:"p-4 max-w-6xl mx-auto flex justify-between items-center",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h1",{className:"text-2xl font-semibold text-white",children:"Quản l\xfd Tin Nhắn"}),(0,i.jsx)("p",{className:"text-gray-400",children:"Danh s\xe1ch tin nhắn"})]}),(0,i.jsx)("button",{className:"bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600",onClick:()=>p(!0),children:"Th\xeam Tin Nhắn"})]}),(0,i.jsx)("section",{className:"p-4 max-w-6xl mx-auto space-y-4",children:h.map(e=>{var t,r;let a=JSON.parse(e.noidung);return(null==d?void 0:d.ten)||null===(t=n.find(t=>t.id===e.giangvienId))||void 0===t||t.ten,(null===(r=n.find(t=>t.id===e.giangvienId))||void 0===r?void 0:r.ten)||null==d||d.ten,(0,i.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg flex flex-col",children:[(0,i.jsxs)("p",{className:"text-lg font-semibold text-white",children:["M\xe3 Tin Nhắn: ",e.id]}),(0,i.jsx)("div",{className:"flex flex-col space-y-2 mt-2",children:a.map((e,t)=>{let r="nguoidung"===e.sender_type,a="giangvien"===e.sender_type,s="Kh\xf4ng x\xe1c định";if("nguoidung"===e.sender_type)s=(null==d?void 0:d.ten)||"Người d\xf9ng kh\xf4ng x\xe1c định";else if("giangvien"===e.sender_type){let t=n.find(t=>t.id===e.sender_id);s=(null==t?void 0:t.ten)||"Giảng vi\xean kh\xf4ng x\xe1c định"}return(0,i.jsxs)("div",{className:"p-2 rounded max-w-md ".concat(r?"bg-blue-600 self-start":a?"bg-green-600 self-end":"bg-gray-600"),children:[(0,i.jsx)("p",{className:"text-gray-200 font-bold",children:s}),(0,i.jsx)("p",{className:"text-gray-300",children:e.content}),(0,i.jsx)("p",{className:"text-gray-400 text-sm",children:e.timestamp})]},t)})})]},e.id)})}),g&&(0,i.jsx)(o,{onClose:()=>p(!1),csrfToken:e,giangVien:n,nguoiDung:d,refreshData:m}),(0,i.jsx)(a.Ix,{})]})]})}},57587:(e,t,n)=>{"use strict";n.d(t,{B2:()=>o,Bn:()=>l,H_:()=>a,PG:()=>s,n_:()=>d,tp:()=>r});var i=n(20357);let r=async()=>{let e;let t=localStorage.getItem("data");if(!t)throw Error("No user data found");try{e=JSON.parse(t)}catch(e){throw Error("Invalid user data")}let n=await fetch("http://huuphuoc.id.vn/api/showAllNhanTin",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_nguoidung:e.id})});if(!n.ok)throw Error("Failed to fetch messages");return n.json()},a=async()=>{let e;let t=localStorage.getItem("data");if(!t)throw Error("No user data found");try{e=JSON.parse(t)}catch(e){throw Error("Invalid user data")}let n=await fetch("http://huuphuoc.id.vn/api/laynguoidung",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_nguoidung:e.id})});if(!n.ok)throw Error("Failed to fetch messages");return n.json()},s=async()=>{let e=await fetch("http://huuphuoc.id.vn/api/giangvien",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to fetch lecturers");return e.json()},o=async()=>{let e=JSON.parse(localStorage.getItem("lecturerId")),t=i.env.REACT_APP_API_URL||"http://huuphuoc.id.vn/api/showAllNhanTinGiangVien";try{let n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_giangvien:e.giangvien})});if(!n.ok)throw Error("Failed to fetch messages");return n.json()}catch(e){throw Error("Network error")}},l=async()=>{try{let e=await fetch("http://huuphuoc.id.vn/api/showAllNguoiDung",{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw Error("Failed to fetch users");return e.json()}catch(e){throw Error("Network error")}},d=async()=>{let e;let t=localStorage.getItem("lecturerId");if(!t)throw Error("No lecturer ID found in localStorage");try{e=JSON.parse(t)}catch(e){throw Error("Failed to parse lecturer data")}let n=await fetch("http://huuphuoc.id.vn/api/giangVienHientai",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_giangvien:e.giangvien})});if(!n.ok)throw Error("Failed to fetch current lecturer data");return n.json()}},53982:()=>{}},e=>{var t=t=>e(e.s=t);e.O(0,[5950,7265,8173,4974,5919,5956,2130,8472,624,5497,7130,6215,1744],()=>t(89306)),_N_E=e.O()}]);