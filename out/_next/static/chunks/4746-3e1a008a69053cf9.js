"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4746],{44746:(e,a,r)=>{r.d(a,{default:()=>v});var t=r(95155),i=r(12115),o=r(9949),n=r(88690),s=r(25373),l=r(45389),c=r(25442),d=r(60863),h=r(87389),g=r(31130),u=r(76172),m=r(43083),p=r(31027),w=r(1797),y=r(47123),x=r(91068);let f=(0,w.P)(o.a),j=(0,n.oY)({colors:{primary:"rgb(50, 173, 230)"}}),S=()=>{localStorage.getItem("data")||localStorage.setItem("data",JSON.stringify({giangvien:{id:1,name:"Default Giangvien"}})),localStorage.getItem("dataForm")||localStorage.setItem("dataForm",JSON.stringify({id_magiamgia:null}))},v=()=>{let[e,a]=(0,i.useState)([]),[r,n]=(0,i.useState)(null),[w,v]=(0,i.useState)(""),[b,N]=(0,i.useState)(""),[k,E]=(0,i.useState)(""),[G,F]=(0,i.useState)(!1);(0,i.useEffect)(()=>{S(),(async()=>{try{let e=await (0,y.NI)();a(e)}catch(e){x.oR.error("Failed to fetch data.")}})()},[]);let C=e=>{n(a=>a===e?null:e)},O=async()=>{if(r)try{let e=JSON.parse(localStorage.getItem("dataForm"))||{};e.id_magiamgia=r,localStorage.setItem("dataForm",JSON.stringify(e)),await (0,y.av)(r),x.oR.success("Coupon ID sent successfully!")}catch(e){x.oR.error("Error sending coupon ID.")}else x.oR.info("No coupon selected.")},_=e.filter(e=>{let a=!G||e.giamgia>=50;return(""===w||e.giamgia>=w)&&(""===b||e.luotsudung>=b)&&(""===k||new Date(e.ngaybatdau)<=new Date(k)&&new Date(e.ngayketthuc)>=new Date(k))&&a});return(0,t.jsxs)(s.s,{theme:j,children:[(0,t.jsxs)(l.m,{maxW:"full",height:"100vh",py:8,bg:"gray.50",position:"relative",overflowY:"auto",children:[(0,t.jsx)(c.D,{as:"h2",size:"lg",mb:6,color:"primary",textAlign:"center",children:"Danh s\xe1ch M\xe3 Giảm Gi\xe1 Kh\xf3a Học"}),(0,t.jsxs)(o.a,{mb:6,px:4,children:[(0,t.jsxs)(d.l,{placeholder:"Filter by discount percentage",value:w,onChange:e=>v(e.target.value),mb:4,children:[(0,t.jsx)("option",{value:"",children:"All"}),(0,t.jsx)("option",{value:"10",children:"10% or more"}),(0,t.jsx)("option",{value:"20",children:"20% or more"}),(0,t.jsx)("option",{value:"30",children:"30% or more"})]}),(0,t.jsxs)(d.l,{placeholder:"Filter by user count",value:b,onChange:e=>N(e.target.value),mb:4,children:[(0,t.jsx)("option",{value:"",children:"All"}),(0,t.jsx)("option",{value:"100",children:"100 or more"}),(0,t.jsx)("option",{value:"200",children:"200 or more"}),(0,t.jsx)("option",{value:"300",children:"300 or more"})]}),(0,t.jsx)(h.p,{type:"date",placeholder:"Filter by date",value:k,onChange:e=>E(e.target.value),mb:4}),(0,t.jsx)(g.S,{isChecked:G,onChange:e=>F(e.target.checked),mb:4,children:"Chỉ hiển thị khuyến m\xe3i tốt nhất (>= 50%)"})]}),(0,t.jsx)(u.r,{columns:{base:1,sm:2,md:3,lg:4},spacing:6,px:4,children:_.map(e=>(0,t.jsxs)(f,{bg:"white",shadow:"lg",rounded:"xl",p:4,position:"relative",onClick:()=>C(e.id),cursor:"pointer",whileHover:{scale:1.1},transition:{duration:.3},border:"2px solid gray",children:[r===e.id&&(0,t.jsx)(o.a,{as:"i",className:"bi bi-check-circle-fill",position:"absolute",top:4,right:2,color:"green.500",fontSize:"32px"}),(0,t.jsxs)(o.a,{mt:4,color:"gray.800",children:[(0,t.jsxs)(m.E,{fontWeight:"bold",fontSize:"md",children:[(0,t.jsx)("i",{className:"bi ".concat(r===e.id?"bi-tag-fill":"bi-tag"),style:{marginRight:"8px"}}),"M\xe3 số: ",e.maso]}),(0,t.jsxs)(m.E,{fontSize:"md",children:[(0,t.jsx)("i",{className:"bi bi-percent",style:{marginRight:"8px"}}),"Giảm gi\xe1: ",e.giamgia,"%"]}),(0,t.jsxs)(m.E,{fontSize:"md",children:[(0,t.jsx)("i",{className:"bi bi-people",style:{marginRight:"8px"}}),"Lượt sử dụng: ",e.luotsudung]}),(0,t.jsxs)(m.E,{fontSize:"md",children:[(0,t.jsx)("i",{className:"bi bi-person-check",style:{marginRight:"8px"}}),"Sử dụng hiện tại: ",e.sudunghientai]}),(0,t.jsxs)(m.E,{fontSize:"md",children:[(0,t.jsx)("i",{className:"bi bi-calendar-event",style:{marginRight:"8px"}}),"Ng\xe0y bắt đầu: ",e.ngaybatdau]}),(0,t.jsxs)(m.E,{fontSize:"md",children:[(0,t.jsx)("i",{className:"bi bi-calendar-x",style:{marginRight:"8px"}}),"Ng\xe0y kết th\xfac: ",e.ngayketthuc]})]})]},e.id))}),(0,t.jsx)(o.a,{textAlign:"center",mt:6,children:(0,t.jsx)(p.$,{colorScheme:"blue",onClick:O,children:"Public"})})]}),(0,t.jsx)(x.N9,{})]})}},47123:(e,a,r)=>{r.d(a,{$2:()=>l,NI:()=>o,WJ:()=>s,av:()=>t,qC:()=>n,sL:()=>i});let t=async e=>{let a=new URLSearchParams(window.location.search).get("id");try{let r=await fetch("http://huuphuoc.id.vn/api/addMaGiamGiaKhoaHoc",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_khoahoc:a,id_magiamgia:e})});if(!r.ok)throw Error("Failed to add MaGiamGia");return r.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},i=async()=>{try{let e=await fetch("http://huuphuoc.id.vn/api/showAllMaGiamGiaKhoaHoc");if(!e.ok)throw Error("Failed to fetch MaGiamGia data");return e.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},o=async()=>{try{let e=await fetch("http://huuphuoc.id.vn/api/showAllMaGiamGia");if(!e.ok)throw Error("Failed to fetch MaGiamGia data");return e.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},n=async e=>{let a=localStorage.getItem("data");if(!a)throw Error("User not authenticated");let r=JSON.parse(a);try{let a=await fetch("http://huuphuoc.id.vn/api/addNguoiDungMaGiamGia",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({trangthai:"Chưa sử dụng",dasudunghientai:"0",id_nguoidung:r.id,id_magiamgia:e.id_magiamgia})});if(!a.ok){let e=await a.json();throw Error(e.message||"Failed to add MaGiamGia")}return a.json()}catch(e){throw console.error("Fetch error:",e),Error(e.message||"Network error or server is down")}},s=async()=>{let e=JSON.parse(localStorage.getItem("data"));if(!e||!e.id)throw Error("User data is missing or invalid");try{let a=await fetch("http://huuphuoc.id.vn/api/showAllNguoiDungMaGiamGia",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_nguoidung:e.id})});if(!a.ok)throw Error("Server error: ".concat(a.statusText));return a.json()}catch(e){throw console.error("Fetch error:",e),Error("Network error or server is down")}},l=async()=>{let e=localStorage.getItem("data"),a=localStorage.getItem("appliedCoupons");if(!e)throw Error("User not authenticated");if(!a)throw Error("No applied coupons found");try{var r;let t=JSON.parse(e),i=a?JSON.parse(a):[];if(!t.id||!(null===(r=i[0])||void 0===r?void 0:r.id_magiamgia))throw Error("Invalid user or coupon data");let o=await fetch("http://huuphuoc.id.vn/api/TinhMaGiamGia",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id_nguoidung:t.id,id_magiamgia:i[0].id_magiamgia})});if(!o.ok){let e=await o.json();throw Error(e.message||"Failed to add MaGiamGia")}return o.json()}catch(e){throw console.error("Fetch error:",e),Error(e.message||"Network error or server is down")}}}}]);